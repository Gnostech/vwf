<!DOCTYPE html>

<html>

  <head>

    <title>Virtual World Framework</title>

    <script type="text/javascript">

      var vwf = {

        models: [

          "vwf/model/glge",
          "vwf/model/object",

          "vwf/model/test",
          { "vwf/model/test": undefined },
          { "vwf/model/test": null },
          { "vwf/model/test": "single" },
          { "vwf/model/test": [ "first", "second" ] },
          { "vwf/model/test": [ [ "array" ] ] },

        ],

        views: [

          "vwf/view/glge",
          "vwf/view/test", // dummy to make the rest have the same indexes as the models

          "vwf/view/test",
          { "vwf/view/test": undefined },
          { "vwf/view/test": null },
          { "vwf/view/test": "single" },
          { "vwf/view/test": [ "first", "second" ] },
          { "vwf/view/test": [ [ "array" ] ] },

        ]

      };

    </script>

    <script type="text/javascript" src="../lib/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="../lib/require.js" data-main="../lib/loader"></script>

    <script type="text/javascript" src="qunit.js"></script>

    <script type="text/javascript">

      require( [ "vwf" ], function( vwf ) {

        // Test the kernel-driver interface.

        vwf.ready( function() {

          test( "Models", function() {

            equal( vwf.models[0].tail().module.id, "vwf/model/glge", "GLGE Model by number" );
            equal( vwf.models["vwf/model/glge"].tail().module.id, "vwf/model/glge", "GLGE Model by name" );
            equal( vwf.models[0].tail().module.id, vwf.models["vwf/model/glge"].tail().module.id, "GLGE Model by number and name" );

            equal( vwf.models[1].tail().module.id, "vwf/model/object", "Object Model by number" );
            equal( vwf.models["vwf/model/object"].tail().module.id, "vwf/model/object", "Object Model by name" );
            equal( vwf.models[1].tail().module.id, vwf.models["vwf/model/object"].tail().module.id, "Object Model by number and name" );

          } );

          test ( "Model parameters", function() {

            deepEqual( vwf.models[2].tail().arguments, [], "No arguments" );
            deepEqual( vwf.models[3].tail().arguments, [], "No arguments, explict undefined " );
            deepEqual( vwf.models[4].tail().arguments, [], "No arguments, explict null" );
            deepEqual( vwf.models[5].tail().arguments, [ "single" ], "Single argument as a value" );
            deepEqual( vwf.models[6].tail().arguments, [ "first", "second" ], "Multiple arguments as an array" );
            deepEqual( vwf.models[7].tail().arguments, [ [ "array" ] ], "Array as an argument" );

          } );

          test( "Views", function() {
            equal( vwf.views[0].tail().module.id, "vwf/view/glge", "GLGE View" );
          } );

          test ( "View parameters", function() {

            deepEqual( vwf.views[2].arguments, [], "No arguments" );
            deepEqual( vwf.views[3].arguments, [], "No arguments, explict undefined " );
            deepEqual( vwf.views[4].arguments, [], "No arguments, explict null" );
            deepEqual( vwf.views[5].arguments, [ "single" ], "Single argument as a value" );
            deepEqual( vwf.views[6].arguments, [ "first", "second" ], "Multiple arguments as an array" );
            deepEqual( vwf.views[7].arguments, [ [ "array" ] ], "Array as an argument" );

          } );

          test( "Shared state", function() {

            var model_glge = vwf.models["vwf/model/glge"].tail();
            var view_glge = vwf.views["vwf/view/glge"].tail();

            // The GLGE model and view share state.

            strictEqual( model_glge.state, view_glge.state, "GLGE shared state" );

            // But they don't share it with any other model stage.

            vwf.models.forEach( function( model ) {
                while ( model ) {
                    model === model_glge || notStrictEqual( model.state, model_glge.state, "GLGE state" );
                    model = model.model;
                }
            } );

            // Or with any other view stage.

            vwf.views.every( function( view ) {
                while ( view ) {
                    view === view_glge || notStrictEqual( view.state, view_glge.state, "GLGE state" + view.module.id );
                    view = view.view;
                }
            } );

          } );
         
        } );

      } );

    </script>

    <link rel="stylesheet" type="text/css" href="qunit.css" />

  </head>

  <body>

    <h1 id="qunit-header">Virtual World Framework</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>

    <div id="qunit-fixture">test markup, will be hidden</div>

  </body>

</html>
